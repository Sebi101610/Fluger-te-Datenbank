<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Flugger√§te Suche</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background-image: url("patrouillesuisse.jpg");
  background-size: cover;
  background-position: center;
  background-attachment: fixed;
  color: white;
}

h1 {
  text-align: center;
  margin: 20px;
  text-shadow: 2px 2px 6px black;
}

.search-box {
  text-align: center;
  margin-bottom: 10px;
}

input {
  padding: 8px;
  margin: 3px;
}

button {
  padding: 8px 12px;
  margin: 5px;
  cursor: pointer;
}

table {
  width: 90%;
  margin: 20px auto;
  border-collapse: collapse;
  background: rgba(0,0,0,0.75);
}

th, td {
  border: 1px solid white;
  padding: 10px;
  text-align: center;
}

th {
  background: rgba(0,120,255,0.9);
}

img {
  max-width: 150px;
  border-radius: 5px;
}

#missingBox {
  margin: 20px auto;
  width: 90%;
  max-width: 700px;
  background: rgba(0,0,0,0.85);
  padding: 15px;
  border-radius: 8px;
  display: none;
}
#missingBox div {
  margin-bottom: 15px;
  padding: 8px;
  background: rgba(255,255,255,0.1);
  border-radius: 5px;
}
#missingBox input {
  width: 100px;
}
</style>
</head>

<body>

<h1>Flugger√§te Datenbank</h1>

<div class="search-box">
  <input id="search" placeholder="z.B. F22, P-51, A380"
         onkeypress="if(event.key==='Enter')searchAircraft()">
  <br>
  <button onclick="searchAircraft()">Suchen</button>
  <button onclick="showMissing()">Fehlende anzeigen</button>
  <button onclick="clearMissing()">Liste l√∂schen</button>
</div>

<table id="table">
<tr>
  <th>Name</th>
  <th>Typ</th>
  <th>Hersteller</th>
  <th>Max. Gewicht</th>
  <th>Sitzpl√§tze</th>
  <th>Max. Geschwindigkeit</th>
  <th>Bild</th>
</tr>
</table>

<div id="missingBox">
  <h3>Fehlende Flugger√§te bearbeiten</h3>
  <div id="missingList"></div>
</div>

<script>
// ====== LOKALE SPEZIFIKATIONEN ======
let specs = {
  "a380": ["Flugzeug","Airbus","575.000 kg","555","1020 km/h"],
  "f22": ["Kampfflugzeug","Lockheed Martin","29.000 kg","1","2410 km/h"],
  "p-51": ["Kampfflugzeug","North American","4.000 kg","1","700 km/h"],
  "segelflieger": ["Segelflugzeug","Schleicher","525 kg","1","285 km/h"],
  "falcon 9": ["Rakete","SpaceX","549.000 kg","0","27.000 km/h"],
  "air force one": ["Flugzeug","Boeing","190.000 kg","102","850 km/h"]
};

// ====== FEHLENDE SPEICHERN ======
function saveMissing(name) {
  let missing = JSON.parse(localStorage.getItem("missingAircraft")) || [];
  if (!missing.includes(name.toLowerCase())) {
    missing.push(name.toLowerCase());
    localStorage.setItem("missingAircraft", JSON.stringify(missing));
  }
}

// ====== SUCHE ======
async function searchAircraft() {
  const input = document.getElementById("search");
  const query = input.value.trim();
  const key = query.toLowerCase();
  const table = document.getElementById("table");

  table.querySelectorAll("tr:not(:first-child)").forEach(r => r.remove());
  if (!query) return;

  // ====== Zuerst pr√ºfen, ob es im specs-Objekt schon existiert ======
  if (specs[key]) {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${query}</td>
      <td>${specs[key][0]}</td>
      <td>${specs[key][1]}</td>
      <td>${specs[key][2]}</td>
      <td>${specs[key][3]}</td>
      <td>${specs[key][4]}</td>
      <td>‚Äî</td>
    `;
    table.appendChild(row);
    return;
  }

  // ====== Wenn nicht gefunden, Wikipedia abfragen ======
  try {
    const response = await fetch(
      `https://de.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`
    );
    const data = await response.json();

    if (!data.title) {
      alert("Nicht gefunden. Bitte fehlende Daten erst manuell eintragen!");
      return;
    }

    const s = specs[key] || ["Nicht verf√ºgbar","Nicht verf√ºgbar","‚Äì","‚Äì","‚Äì"];

    if (s.includes("Nicht verf√ºgbar") || s.includes("‚Äì")) {
      saveMissing(data.title.toLowerCase());
    }

    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${data.title}</td>
      <td>${s[0]}</td>
      <td>${s[1]}</td>
      <td>${s[2]}</td>
      <td>${s[3]}</td>
      <td>${s[4]}</td>
      <td>${data.originalimage ? `<img src="${data.originalimage.source}">` : "‚Äî"}</td>
    `;
    table.appendChild(row);

  } catch (err) {
    console.error(err);
    alert("Fehler bei der Suche. Ger√§t bitte manuell eintragen!");
  }
}

// ====== FEHLENDE ANZEIGEN + EDITIEREN ======
function showMissing() {
  const box = document.getElementById("missingBox");
  const listDiv = document.getElementById("missingList");
  listDiv.innerHTML = "";

  const missing = JSON.parse(localStorage.getItem("missingAircraft")) || [];

  if (missing.length === 0) {
    listDiv.innerHTML = "<p>Keine fehlenden Flugger√§te üëç</p>";
  } else {
    missing.forEach(name => {
      const div = document.createElement("div");
      const s = specs[name.toLowerCase()] || ["", "", "", "", ""];
      div.innerHTML = `
        <strong>${name}</strong><br>
        Typ: <input id="type-${name}" placeholder="Flugzeug" value="${s[0]}"><br>
        Hersteller: <input id="hersteller-${name}" placeholder="Airbus" value="${s[1]}"><br>
        Gewicht: <input id="gewicht-${name}" placeholder="kg" value="${s[2]}"><br>
        Sitzpl√§tze: <input id="sitze-${name}" placeholder="1" value="${s[3]}"><br>
        Max. Geschwindigkeit: <input id="speed-${name}" placeholder="km/h" value="${s[4]}"><br>
        <button onclick="saveSpecs('${name}')">Speichern</button>
      `;
      listDiv.appendChild(div);
    });
  }

  box.style.display = "block";
}

// ====== SPEZIFIKATIONEN SPEICHERN ======
function saveSpecs(name) {
  const type = document.getElementById(`type-${name}`).value.trim();
  const hersteller = document.getElementById(`hersteller-${name}`).value.trim();
  const gewicht = document.getElementById(`gewicht-${name}`).value.trim();
  const sitze = document.getElementById(`sitze-${name}`).value.trim();
  const speed = document.getElementById(`speed-${name}`).value.trim();

  if (!type && !hersteller && !gewicht && !sitze && !speed) {
    alert("Bitte mindestens ein Feld ausf√ºllen, bevor du speicherst!");
    return;
  }

  specs[name.toLowerCase()] = [
    type || "Nicht verf√ºgbar",
    hersteller || "Nicht verf√ºgbar",
    gewicht || "‚Äì",
    sitze || "‚Äì",
    speed || "‚Äì"
  ];

  let missing = JSON.parse(localStorage.getItem("missingAircraft")) || [];
  missing = missing.filter(n => n.toLowerCase() !== name.toLowerCase());
  localStorage.setItem("missingAircraft", JSON.stringify(missing));

  alert(`${name} wurde gespeichert!`);
  showMissing();
}

// ====== LISTE L√ñSCHEN ======
function clearMissing() {
  localStorage.removeItem("missingAircraft");
  alert("Liste gel√∂scht");
  document.getElementById("missingBox").style.display = "none";
}
</script>

</body>
</html>
